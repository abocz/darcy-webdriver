language: java
jdk:
- oraclejdk8

before_install:
  - git clone -b travis `git config --get remote.origin.url` target/travis
  # Repos
  - sudo apt-add-repository "deb http://deb.opera.com/opera/ stable non-free"
  - sudo apt-add-repository "deb http://dl.google.com/linux/chrome/deb/ stable main"
  # Remove "deb-src" repos added from apt-add-repository, because it doesn't exist online
  - sudo sed -i s/deb-src.*opera.*//g /etc/apt/sources.list
  - sudo sed -i s/deb-src.*google.*//g /etc/apt/sources.list
  # Add apt-keys for checking the packages
  - wget -O - http://deb.opera.com/archive.key | sudo apt-key add -
  - wget -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
  # Mke sure
  - sudo apt-get update -qq
  # Install the browsers
  - sudo apt-get install -y chromium-browser opera firefox google-chrome-stable
  # xvfb
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"

install: '[ ${TRAVIS_PULL_REQUEST} = ''false'' ] && mvn clean deploy -P sonatype-oss-release -Dgpg.skip=true --settings target/travis/settings.xml || mvn clean verify --settings target/travis/settings.xml'

after_success:
  - mvn clean jacoco:prepare-agent test jacoco:report coveralls:jacoco

branches:
  only:
  - master
  - add-browsers-travis-wip

env:
  global:
  - secure: jwhbfbFNFeQpSLq8UkJfJX4HM3Q3axewkLdTAs/RicAfBKSoDZqVos9LAQcYeuN0iECDjos2hiG6CtiBncmK6D8FsjMdpNRXAip+oz+ChJqAq+Ch1HUejq2clKiSZb0abCMGOLPgmX9b0XbHf4qoyxUIJBpRyLjO0248OG9YifU=
  - secure: aWqtpf1d+NsArtPWYvGweoWeqjvUJnnp7FZ6BV7z6XJROW5aIYazEPOZ3C3Oa0TO5rK0pL9nItfMPE9GCbHxgpsiYuz8DTKvs+wTOmj3LprivAhk3PqYZN2+LfFEG9cRbxZTPBXDVRZ5jjGIcgxcLq0q6kv6Lka7aGrFtNozwMI=
  - CHROME_BIN = chromium-browser